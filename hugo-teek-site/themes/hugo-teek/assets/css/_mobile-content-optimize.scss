// ========================================
// Mobile Content Optimization
// 移动端正文内容优化
// ========================================

// 全局移动端防溢出
@media (max-width: 960px) {
  // 防止任何元素超出屏幕宽度
  html,
  body {
    max-width: 100% !important;
    overflow-x: hidden !important;
  }

  // 确保主容器不超出屏幕
  .VPDoc,
  .VPContent,
  .container,
  .content,
  .content-container {
    max-width: 100% !important;
    overflow-x: hidden !important;
  }

  // 所有直接子元素都不超出父容器
  .vp-doc > *,
  .tk-doc-content > *,
  .post-grid > * {
    max-width: 100% !important;
    overflow-wrap: break-word;
    word-wrap: break-word;
    word-break: break-word;

    // 特殊情况：代码块和表格允许横向滚动
    &.highlight,
    &[class*="language-"],
    &.vp-code-block,
    &.article-card-compact {
      overflow-x: hidden;
      -webkit-overflow-scrolling: touch;
      max-width: 100% !important;
    }
  }

  // 通用选择器 - 所有元素都不超出视口（最后一道防线）
  * {
    max-width: 100%;
  }

  // 但内容区的元素限制在父容器内
  .vp-doc *,
  .tk-doc-content *,
  .content-container *,
  .post-grid * {
    max-width: 100%;
  }
}

// 中等屏幕 (平板/手机横屏)
@media (max-width: 960px) {
  .vp-doc,
  .tk-doc-content {
    // 整体间距调整 - 减小左右边距
    padding: 0 12px;
    max-width: 100%;
    overflow-x: hidden;
    
    // 确保网格容器不超出屏幕
    .post-grid {
      max-width: 100% !important;
      overflow-x: hidden !important;
      width: 100% !important;
      box-sizing: border-box;
    }

    // 标题优化
    h1 {
      font-size: 26px !important;
      line-height: 1.3;
      margin: 24px 0 16px;
    }

    h2,
    .docs-article__body h2 {
      font-size: 22px !important;
      line-height: 1.4;
      margin: 16px 0 12px;
      padding-top: 8px;
      border-top: 1px solid var(--vp-c-divider);
    }

    h3 {
      font-size: 19px !important;
      line-height: 1.4;
      margin: 24px 0 10px;
    }

    h4 {
      font-size: 17px !important;
      line-height: 1.5;
      margin: 20px 0 8px;
    }

    h5, h6 {
      font-size: 15px !important;
      margin: 16px 0 8px;
    }

    // 段落优化
    p {
      font-size: 18px; // 统一为18px
      line-height: 1.7;
      margin: 12px 0;
    }

    // 列表优化
    ul, ol {
      padding-left: 24px;
      margin: 12px 0;

      li {
        margin: 8px 0;
        line-height: 1.7;
        font-size: 18px; // 与p保持一致
      }
    }

    // 引用优化
    blockquote {
      margin: 16px 0;
      padding: 12px 16px;
      border-left-width: 3px;
      font-size: 16px;

      p {
        font-size: 16px;
        line-height: 1.6;
      }
    }

    // 代码块优化 - 强制适配移动端
    div[class*="language-"],
    .highlight,
    .vp-code-block {
      margin: 16px 0 !important;
      border-radius: 8px !important;
      width: 100% !important;
      max-width: 100% !important;
      min-width: 0 !important;
      -webkit-overflow-scrolling: touch;
      box-sizing: border-box !important;

      // 自定义滚动条样式
      &::-webkit-scrollbar {
        height: 6px;
      }

      &::-webkit-scrollbar-track {
        background: rgba(0, 0, 0, 0.05);
        border-radius: 0;
      }

      &::-webkit-scrollbar-thumb {
        background: rgba(0, 0, 0, 0.2);
        border-radius: 3px;

        &:hover {
          background: rgba(0, 0, 0, 0.3);
        }
      }

      // 代码内容区域（非table布局）
      > pre {
        margin: 0 !important;
        padding: var(--tk-code-block-fold-height, 40px) 12px 12px !important;
        max-width: 100% !important;
        width: 100% !important;
        overflow-x: visible !important;
        white-space: pre !important;
        box-sizing: border-box !important;

        code {
          font-size: 15px !important; // 固定15px，不使用em
          line-height: 1.6 !important;
          padding: 0 !important;
          display: block !important;
          width: auto !important;
          max-width: 100% !important;
          min-width: 0 !important;
          word-wrap: normal !important;
          white-space: pre !important;
        }
      }

      // 高亮行 - 非table布局
      > pre .hl,
      > pre .line.highlighted {
        display: block;
        margin: 0;
        padding: 0;
      }

      // 内联行号样式（lineNumbersInTable = false）
      .ln,
      .lnt {
        width: 28px;
        margin-right: 8px;
        padding-right: 6px;
        font-size: 15px !important;
        line-height: 1.6 !important;
      }
    }

    // 行内代码 - 统一固定大小
    code {
      font-size: 15px !important; // 固定15px，不使用em
      padding: 2px 6px;
      line-height: 1.5;
    }

    // // 图片优化 - 严格限制宽度，继承全局样式 - 重构文档落地页的图片样式
    // // 由 hugo-teek-site\themes\hugo-teek\assets\css\vitepress-teek-docs.scss 控制
    // // 写了好像没用，先留着代码吧~
    // img {
    //   max-width: calc(100% - 32px) !important; // ◀️ 确保图片有足够空间显示阴影
    //   width: auto !important;
    //   height: auto !important;
    //   margin: 16px auto !important; // ◀️ 继承全局样式
    //   display: block !important;
    //   object-fit: contain !important;
    //   // 其他样式继承自全局定义，不再重复
    // }

    // 视频/iframe优化
    iframe,
    video,
    embed,
    object {
      max-width: 100% !important;
      height: auto !important;
    }

    // 表格优化 - 添加横向滚动容器
    table {
      display: block;
      width: 100%;
      max-width: 100%;
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
      margin: 16px 0;
      font-size: 16px; // 统一表格字体大小

      th, td {
        padding: 10px 12px;
        min-width: 80px;
        white-space: nowrap;
      }
    }

    // 长文本强制换行
    p, li, span, div {
      word-wrap: break-word;
      overflow-wrap: break-word;
      word-break: break-word;
      hyphens: auto;
    }

    // 长链接强制换行
    a {
      word-break: break-all;
    }

    // 预格式化文本（非代码块）
    pre:not([class*="language-"]) {
      white-space: pre-wrap;
      word-wrap: break-word;
      overflow-x: auto;
    }

    // 水平线
    hr {
      margin: 24px 0;
    }
  }

  // 文档头部优化
  .tk-doc-header {
    padding: 0 12px;

    &__top {
      margin-bottom: 12px;
    }

    &__meta {
      flex-wrap: wrap;
      gap: 8px;
    }
  }

  // VPDoc容器移动端优化
  .VPDoc.has-sidebar .container > .content {
    padding: 0 12px 128px;
  }

  .VPDoc.has-sidebar .container > .content .content-container {
    padding: 24px 12px;
  }

  // 面包屑简化
  .tk-article-breadcrumb {
    font-size: 15px;

    .breadcrumb-item {
      max-width: 120px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
  }
}

// 小屏幕 (手机竖屏)
@media (max-width: 640px) {
  .vp-doc,
  .tk-doc-content {
    padding: 0 8px;
    max-width: 100%;
    overflow-x: hidden;

    // 更小的标题
    h1 {
      font-size: 24px !important;
      margin: 20px 0 12px;
    }

    h2 {
      font-size: 20px !important;
      margin: 28px 0 10px;
      padding-top: 12px;
    }

    h3 {
      font-size: 18px !important;
      margin: 20px 0 8px;
    }

    h4 {
      font-size: 16px !important;
      margin: 16px 0 8px;
    }

    h5, h6 {
      font-size: 15px !important;
    }

    // 段落 - 统一为16px
    p {
      font-size: 16px !important;
      line-height: 1.75;
    }

    // 列表 - 统一为16px
    ul, ol {
      padding-left: 20px;

      li {
        font-size: 16px !important;
        line-height: 1.75;
      }
    }

    // 引用
    blockquote {
      padding: 10px 12px;
      font-size: 15px;

      p {
        font-size: 15px;
      }
    }

    // 代码块优化 - 小屏幕
    div[class*="language-"],
    .highlight,
    .vp-code-block {
      margin: 16px 0 !important;
      width: 100% !important;
      max-width: 100% !important;
      min-width: 0 !important;
      font-size: 14px !important;
      box-sizing: border-box !important;

      > pre {
        padding: var(--tk-code-block-fold-height, 40px) 8px 24px !important; // ◀️ 增加底部内边距，确保代码块最后一行距离底部边缘有12px空白
        font-size: 14px !important;
        width: 100% !important;
        max-width: 100% !important;
        overflow-x: visible !important;
        box-sizing: border-box !important;

        code {
          font-size: 14px !important; // 固定14px
          line-height: 1.5 !important;
          display: block !important;
          width: auto !important;
          max-width: 100% !important;
          min-width: 0 !important;
          word-wrap: normal !important;
          white-space: pre !important;
        }
      }

      // 内联行号样式（小屏幕）
      .ln,
      .lnt {
        width: 24px;
        margin-right: 6px;
        padding-right: 4px;
        font-size: 14px !important;
        line-height: 1.5 !important;
      }

      // 高亮行（小屏幕）
      > pre .hl,
      > pre .line.highlighted {
        display: block;
        margin: 0;
        padding: 0;
      }
    }

    // 行内代码 - 小屏幕统一
    code {
      font-size: 14px !important; // 固定14px
      padding: 2px 5px;
    }

    // 表格
    table {
      font-size: 15px;

      th, td {
        padding: 8px 10px;
        font-size: 15px;
      }
    }

    // 图片间距，继承全局样式
    img {
      margin: 12px auto !important;
      max-width: calc(100% - 24px) !important; // ◀️ 小屏幕下调整边距
    }
  }

  // 文档头部
  .tk-doc-header {
    padding: 0 8px;
  }

  // VPDoc容器移动端优化
  .VPDoc.has-sidebar .container > .content {
    padding: 0 8px 128px;
  }

  .VPDoc.has-sidebar .container > .content .content-container {
    padding: 20px 8px;
  }

  // 面包屑更简化
  .tk-article-breadcrumb {
    font-size: 14px;

    .breadcrumb-item {
      max-width: 100px;
    }
  }

  // 文章元信息
  .tk-article-info {
    font-size: 14px;
    flex-wrap: wrap;

    &__item {
      font-size: 14px;
    }
  }
}

// 超小屏 (iPhone SE等)
@media (max-width: 375px) {
  .vp-doc,
  .tk-doc-content {
    max-width: 100%;
    overflow-x: hidden;

    h1 {
      font-size: 22px !important;
    }

    h2 {
      font-size: 19px !important;
    }

    h3 {
      font-size: 17px !important;
    }

    p, li {
      font-size: 15px !important; // 统一为15px
    }

    pre code {
      font-size: 13px !important; // 固定13px
      line-height: 1.5 !important;
    }

    // 内联行号样式（超小屏）
    .ln,
    .lnt {
      width: 22px;
      margin-right: 4px;
      padding-right: 3px;
      font-size: 13px !important;
      line-height: 1.5 !important;
    }
  }
}

// 通用移动端防溢出规则（所有尺寸）
@media (max-width: 960px) {
  // Hugo自定义容器
  .custom-block,
  .vp-custom-block,
  .tk-custom-block {
    max-width: 100% !important;
    overflow-x: auto;
  }

  // 图片容器
  figure,
  .figure,
  .image-container {
    max-width: 100% !important;
    margin-left: auto;
    margin-right: auto;

    img {
      max-width: calc(100% - 32px) !important; // ◀️ 确保图片有足够空间显示阴影
      height: auto !important;
    }
  }

  // SVG图形
  svg {
    max-width: 100% !important;
    height: auto !important;
  }

  // 引用块
  blockquote {
    max-width: 100%;
    overflow-x: auto;

    * {
      max-width: 100%;
    }
  }

  // 有序/无序列表
  ul, ol {
    max-width: 100%;
    padding-left: 20px;

    li {
      max-width: 100%;
    }
  }

  // 水平滚动容器标记
  .scrollable-x,
  .overflow-x-auto {
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
    max-width: 100%;
  }
}

// 代码块复制按钮移动端优化
@media (max-width: 640px) {
  .vp-doc pre .copy-button,
  .tk-doc-content pre .copy-button {
    width: 36px;
    height: 36px;
    top: 8px;
    right: 8px;
    opacity: 1; // 移动端始终显示
  }
}

// VitePress 自定义容器移动端优化
@media (max-width: 640px) {
  .vp-doc .custom-block,
  .tk-doc-content .custom-block {
    margin: 12px -12px;
    padding: 12px;
    border-left-width: 3px;
    border-radius: 0;
  }
}

// 内联TOC移动端优化
@media (max-width: 960px) {
  .inline-toc {
    padding: 12px;
    margin: 16px -12px;
    border-width: 1px;
    border-radius: 0;
  }
}

@media (max-width: 640px) {
  .inline-toc {
    padding: 10px;
    margin: 16px -8px;
    border-width: 1px;
    border-radius: 0;

    .inline-toc-title {
      font-size: 15px;
    }

    .inline-toc-link {
      font-size: 14px;
      padding: 4px 0;
    }
  }
}
