{{/*
  极速版面包屑：O(1) 查表，零计算开销

  性能对比：
  - 旧版：遍历 .Ancestors，正则替换，O(n) 复杂度
  - 新版：直接查 breadcrumbsMap，O(1) 复杂度

  支持两种数据源：
  - 拆分模式：site.Data.sidebar.breadcrumbs (推荐，性能更优)
  - 传统模式：site.Data.sidebarOrder.breadcrumbsMap (向后兼容)
*/}}
{{- $current := . -}}

{{/* 标准化文件路径 */}}
{{- $relPath := "" -}}
{{- with $current.File -}}
  {{- $relPath = .Path -}}
  {{- $relPath = strings.TrimPrefix "/" $relPath -}}
  {{- $relPath = strings.TrimPrefix ".content-vp-converted/docs/" $relPath -}}
  {{- $relPath = strings.TrimPrefix "content/docs/" $relPath -}}
  {{- $relPath = strings.TrimPrefix "docs/" $relPath -}}
{{- end -}}

{{/* 从预生成的 breadcrumbsMap 中查表（支持拆分和传统模式） */}}
{{- $breadcrumbsMap := site.Data.sidebar.breadcrumbs | default site.Data.sidebarOrder.breadcrumbsMap -}}
{{- $breadcrumbs := index $breadcrumbsMap $relPath -}}

{{- if $breadcrumbs -}}
<nav class="tk-article-breadcrumb" aria-label="文章面包屑">
  <div class="tk-breadcrumb">
    {{/* 首页图标 */}}
    <span class="tk-breadcrumb__item">
      <span class="tk-breadcrumb__inner">
        <a href="/" class="tk-breadcrumb__home hover-color" title="返回首页" aria-label="返回首页">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 1024" width="16" height="16" fill="currentColor" aria-hidden="true">
            <path d="M946.5 505L560.1 118.8l-25.9-25.9a31.5 31.5 0 0 0-44.4 0L77.5 505a63.9 63.9 0 0 0-18.8 46c.4 35.2 29.7 63.3 64.9 63.3h42.5V940h691.8V614.3h43.4c17.1 0 33.2-6.7 45.3-18.8a63.6 63.6 0 0 0 18.7-45.3c0-17-6.7-33.1-18.8-45.2M568 868H456V664h112zm217.9-325.7V868H632V640c0-22.1-17.9-40-40-40H432c-22.1 0-40 17.9-40 40v228H238.1V542.3h-96l370-369.7 23.1 23.1L882 542.3z"/>
          </svg>
        </a>
      </span>
      <span class="tk-breadcrumb__separator">/</span>
    </span>

    {{- range $index, $item := $breadcrumbs }}
      <span class="tk-breadcrumb__item">
        <span class="tk-breadcrumb__inner">
          {{- if and .isLink .url -}}
            <a href="{{ .url }}" class="hover-color" title="{{ .title }}">{{ .title }}</a>
          {{- else -}}
            <span title="{{ .title }}">{{ .title }}</span>
          {{- end -}}
        </span>
        {{- if lt (add $index 1) (len $breadcrumbs) }}
          <span class="tk-breadcrumb__separator">/</span>
        {{- end -}}
      </span>
    {{- end -}}
  </div>
</nav>
{{- end -}}
