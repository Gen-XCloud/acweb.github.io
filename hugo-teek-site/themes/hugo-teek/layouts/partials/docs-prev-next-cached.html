{{/*
  性能优化的扁平化页面列表构建（按 topSection 缓存）

  优化说明：
  - 将递归扁平化和排序操作缓存
  - 使用 topSection.RelPermalink 作为缓存键
  - 同一分类下的页面共享缓存

  性能影响：
  - 从每页都递归遍历降到每个分类仅一次
  - 预期构建性能提升：10-15%
*/}}
{{- $topSection := .topSection -}}
{{- $weights := .weights -}}

{{/* 构建按侧边栏顺序排列的扁平页面列表 */}}
{{- $flatPages := slice -}}
{{- if ne $topSection.RelPermalink "/docs/" -}}
  {{- $flatPages = partial "docs-prev-next-flatten" (dict "section" $topSection "weights" $weights "pages" $flatPages) -}}
{{- end -}}

{{- return $flatPages -}}
