<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="color-scheme" content="light dark">

<script>
  // ä¸»é¢˜åˆå§‹åŒ–ï¼šåœ¨é¡µé¢æ¸²æŸ“å‰è®¾ç½®ï¼Œé¿å…é—ªçƒ
  (function() {
    try {
      var storedTheme = localStorage.getItem('theme');
      var prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
      var isDark = storedTheme === 'dark' || (!storedTheme && prefersDark);

      if (isDark) {
        document.documentElement.classList.add('dark-mode');
        // å°†æš—è‰²æ¨¡å¼çŠ¶æ€ä¿å­˜åˆ°å…¨å±€å˜é‡ï¼Œä¾› body æ ‡ç­¾ä½¿ç”¨
        window.__INITIAL_THEME__ = 'dark';
      } else {
        window.__INITIAL_THEME__ = 'light';
      }
    } catch (err) {
      // Ignore access issues (e.g. Safari private mode)
      window.__INITIAL_THEME__ = 'light';
    }
  })();

  // å…¬ä¼—å·è§£é”çŠ¶æ€æ£€æŸ¥ï¼šåœ¨é¡µé¢æ¸²æŸ“å‰æ£€æŸ¥ï¼Œé¿å…é—ªçƒ
  (function() {
    try {
      // è§„èŒƒåŒ–URLï¼ˆå»æ‰æœ«å°¾æ–œæ ï¼Œç»Ÿä¸€æ¯”å¯¹ï¼‰
      function normalizeUrl(url) {
        return url.replace(/\/$/, '').toLowerCase();
      }

      var currentUrl = normalizeUrl(window.location.href);
      var unlockedArticles = JSON.parse(localStorage.getItem('unlockedArticles') || '[]');

      // æ£€æŸ¥å½“å‰é¡µé¢æ˜¯å¦å·²è§£é”
      var isUnlocked = unlockedArticles.some(function(article) {
        return normalizeUrl(article.permalink) === currentUrl;
      });

      // å¦‚æœå·²è§£é”ï¼Œæ·»åŠ æ ‡è®°classåˆ°htmlå…ƒç´ 
      if (isUnlocked) {
        document.documentElement.classList.add('wechat-unlocked');
        console.log('[WechatUnlock] é¡µé¢å·²è§£é”ï¼ˆä»ç¼“å­˜ï¼‰');
      }
    } catch (err) {
      // localStorageè®¿é—®å¤±è´¥æ—¶å¿½ç•¥ï¼ˆå¦‚Safariéšç§æ¨¡å¼ï¼‰
      console.error('[WechatUnlock] æ£€æŸ¥å¤±è´¥:', err);
    }

    // ç‰©ç†åˆ é™¤æœªè§£é”çš„å†…å®¹ï¼ˆDOMçº§åˆ«ä¿æŠ¤ï¼‰
    // åœ¨DOMContentLoadedæ—¶æ‰§è¡Œï¼Œç¡®ä¿DOMå·²åŠ è½½
    function removeLockedContent() {
      // å¦‚æœå·²è§£é”ï¼Œä¸åˆ é™¤å†…å®¹
      if (document.documentElement.classList.contains('wechat-unlocked')) {
        return;
      }

      var gate = document.querySelector('.wechat-unlock-gate');
      if (!gate) return;

      // åˆ é™¤è§£é”é—¨ä¹‹åçš„æ‰€æœ‰å…„å¼Ÿå…ƒç´ 
      var next = gate.nextElementSibling;
      while (next) {
        var toRemove = next;
        next = next.nextElementSibling;
        toRemove.remove();
      }

      console.log('[WechatUnlock] å·²ç§»é™¤é”å®šå†…å®¹çš„DOMèŠ‚ç‚¹');
    }

    // ç«‹å³æ‰§è¡Œæˆ–åœ¨DOMåŠ è½½åæ‰§è¡Œ
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', removeLockedContent);
    } else {
      // å¦‚æœè„šæœ¬åœ¨bodyä¸­æ‰§è¡Œï¼ŒDOMå¯èƒ½å·²ç»åŠ è½½
      removeLockedContent();
    }
  })();
</script>

<title>{{ if .IsHome }}{{ .Site.Title }} | {{ .Site.Params.blogger.slogan }}{{ else }}{{ .Title }} - {{ .Site.Title }}{{ end }}</title>

<meta name="description" content="{{ if and .Description (ne .Description "") }}{{ .Description }}{{ else }}{{ .Site.Params.description }}{{ end }}">
{{ $keywords := (.Keywords | default (.Site.Params.keywords | default (slice))) }}
{{ if gt (len $keywords) 0 }}
<meta name="keywords" content="{{ delimit $keywords ", " }}">
{{ end }}
<meta name="author" content="{{ .Site.Params.author.name }}">

<!-- Open Graph -->
<meta property="og:title" content="{{ if .IsHome }}{{ .Site.Title }} | {{ .Site.Params.blogger.slogan }}{{ else }}{{ .Title }}{{ end }}">
<meta property="og:description" content="{{ if and .Description (ne .Description "") }}{{ .Description }}{{ else }}{{ .Site.Params.description }}{{ end }}">
<meta property="og:type" content="{{ if .IsPage }}article{{ else }}website{{ end }}">
<meta property="og:url" content="{{ .Permalink }}">
{{ if .Params.coverImg }}
<meta property="og:image" content="{{ .Params.coverImg | absURL }}">
{{ end }}

<!-- Twitter Card -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="{{ if .IsHome }}{{ .Site.Title }} | {{ .Site.Params.blogger.slogan }}{{ else }}{{ .Title }}{{ end }}">
<meta name="twitter:description" content="{{ if and .Description (ne .Description "") }}{{ .Description }}{{ else }}{{ .Site.Params.description }}{{ end }}">

<!-- Favicon - ä½¿ç”¨ç”¨æˆ·å¤´åƒ -->
{{ if .Site.Params.blogger.avatar }}
<link rel="icon" type="image/webp" href="{{ .Site.Params.blogger.avatar }}">
<link rel="apple-touch-icon" href="{{ .Site.Params.blogger.avatar }}">
{{ else }}
<link rel="icon" type="image/x-icon" href="/favicon.ico">
{{ end }}

<!-- Performance: é¢„åŠ è½½å…³é”®å­—ä½“ (Inter æ‹‰ä¸å­—ç¬¦) -->
<!-- å·²ç¦ç”¨ï¼šå­—ä½“æ–‡ä»¶ä¸å­˜åœ¨ï¼Œstyle.css ä¼šè‡ªåŠ¨åŠ è½½ï¼Œé™çº§åˆ°ç³»ç»Ÿå­—ä½“ -->
<!-- <link rel="preload" as="font" type="font/woff2" href="/assets/inter-roman-latin.Di8DUHzh.woff2" crossorigin> -->

<!-- ğŸ†• Performance: Swup CDN é¢„è¿æ¥ (å…¨ç«™ SPA ä¼˜åŒ–) -->
<link rel="preconnect" href="https://unpkg.com" crossorigin>
<link rel="dns-prefetch" href="https://unpkg.com">

<!-- Performance: é¢„è¿æ¥ç¬¬ä¸‰æ–¹åŸŸå -->
{{ if .Site.Params.analytics.busuanzi.enabled }}
{{ $busuanziUrl := .Site.Params.analytics.busuanzi.url | default "https://busuanzi-eo.xxdevops.cn/busuanzi.eo.js" }}
{{ $busuanziDomain := replaceRE "^(https?://[^/]+).*$" "$1" $busuanziUrl }}
<link rel="preconnect" href="{{ $busuanziDomain }}" crossorigin>
{{ end }}
{{ if .Site.Params.analytics.umami.enabled }}
<link rel="preconnect" href="{{ .Site.Params.analytics.umami.url }}" crossorigin>
{{ end }}
{{ if .Site.Params.comment.twikoo.enabled }}
<link rel="preconnect" href="{{ .Site.Params.comment.twikoo.envId }}" crossorigin>
{{ end }}

<!-- Critical CSS - å†…è”é¦–å±å…³é”®æ ·å¼ï¼Œæ¶ˆé™¤FOUCé—ªçƒ -->
{{ partial "critical.html" . }}

<!-- Main Styles - åŒæ­¥åŠ è½½ç¡®ä¿é¦–æ¬¡ç»˜åˆ¶æ­£ç¡® -->
{{ $style := resources.Get "css/main.scss" }}
{{ if $style }}
  {{ $style = $style | css.Sass | resources.Minify | resources.Fingerprint }}
  <link rel="stylesheet" href="{{ $style.RelPermalink }}">
{{ end }}

<!-- æ–‡æ¡£åº“ä¸“ç”¨æ ·å¼ - VitePress Teek Theme + Simple Sidebarï¼ˆå¼‚æ­¥åŠ è½½ï¼‰-->
{{ $isDocs := .Scratch.Get "isDocs" | default false }}
{{ if $isDocs }}
  {{ $base := resources.Get "css/teek/style.css" }}
  {{ $custom := resources.Get "css/vitepress-teek-docs.scss" | css.Sass | resources.Minify }}
  {{ $simpleSidebar := resources.Get "css/simple-sidebar.scss" | css.Sass | resources.Minify }}
  {{ $docsStyle := slice $base $custom $simpleSidebar | resources.Concat "css/vitepress-teek-docs.css" | resources.Minify | resources.Fingerprint }}
  <link rel="preload" href="{{ $docsStyle.RelPermalink }}" as="style" onload="this.onload=null;this.rel='stylesheet'">
  <noscript><link rel="stylesheet" href="{{ $docsStyle.RelPermalink }}"></noscript>
{{ end }}

<!-- RSS -->
{{ with .OutputFormats.Get "RSS" }}
<link rel="{{ .Rel }}" type="{{ .MediaType.Type }}" href="{{ .Permalink }}" title="{{ $.Site.Title }}">
{{ end }}

<!-- Lunar Calendar Library (for calendar widget) -->
{{ if .IsHome }}
<script src="/libs/lunar.min.js" defer></script>
{{ end }}

<!-- Friend Links Page Icon Font -->
{{ if eq .Type "friends" }}
<link rel="stylesheet" href="https://cdn.ksah.cn/fonts/icomoon/font.css">
{{ end }}

<!-- Analytics -->
{{ if .Site.Params.analytics.umami.enabled }}
<script async defer
  data-website-id="{{ .Site.Params.analytics.umami.websiteId }}"
  src="{{ .Site.Params.analytics.umami.url }}/script.js">
</script>
{{ end }}

<!-- ç§»åŠ¨ç«¯å¡ç‰‡å®½åº¦å¼ºåˆ¶ä¿®å¤ - å†…è”æ ·å¼æœ€é«˜ä¼˜å…ˆçº§ -->
<style>
@media screen and (max-width: 768px) {
  .article-card-compact {
    width: 100% ;
    max-width: 100% !important;
    min-width: 0 !important;
    flex: none !important;
    box-sizing: border-box !important;
  }

  .post-grid {
    grid-template-columns: 1fr !important;
    width: 100% !important;
    max-width: 100% !important;
    box-sizing: border-box !important;
    gap: 0.75rem !important;
  }

  .home-content-section .container {
    padding-left: 0.75rem !important;
    padding-right: 0.75rem !important;
    max-width: 100vw !important;
    box-sizing: border-box !important;
  }

  .home-content {
    width: 100% !important;
    max-width: 100% !important;
    padding: 0 !important;
    margin: 0 !important;
  }

  .main-column {
    width: 100% !important;
    max-width: 100% !important;
    padding: 0 !important;
    margin: 0 !important;
  }

  /* é˜²æ­¢ä»»ä½•å…ƒç´ è¶…å‡ºå±å¹• */
  html, body {
    max-width: 100vw !important;
    overflow-x: hidden !important;
  }

  .home-page {
    max-width: 100vw !important;
    overflow-x: hidden !important;
  }
}

/* ========================================
   æ–‡æ¡£é¡µé¢å¸ƒå±€å¼ºåˆ¶ä¿®å¤ - è¦†ç›– style.css ä¸­çš„é—®é¢˜æ ·å¼
   ======================================== */

/* ç§»é™¤çˆ¶å®¹å™¨çš„ padding-leftï¼Œè®©å®¹å™¨è´´è¿‘æµè§ˆå™¨å·¦ä¾§è¾¹æ¡† */
.VPContent.has-sidebar {
  padding-left: 0 !important;
  padding-right: 0 !important;
  margin-left: 0 !important;
  margin-right: 0 !important;
}

/* ç§»é™¤æ–‡æ¡£å®¹å™¨çš„æœ€å¤§å®½åº¦é™åˆ¶ã€å±…ä¸­å¯¹é½å’Œå·¦å³è¾¹è· */
.VPDoc.has-sidebar .container {
  max-width: 100% !important;
  width: 100% !important;
  margin-left: 0 !important;
  margin-right: 0 !important;
  padding-left: 0 !important;
  padding-right: 0 !important;
}

/* ç¡®ä¿æ‰€æœ‰å±å¹•å°ºå¯¸éƒ½åº”ç”¨ */
@media (min-width: 960px) {
  .VPContent.has-sidebar {
    padding-left: 0 !important;
    padding-right: 0 !important;
  }
}

@media (min-width: 1280px) {
  .VPContent.has-sidebar {
    padding-left: 0 !important;
    padding-right: 0 !important;
  }

  .VPDoc.has-sidebar .container {
    max-width: 100% !important;
    margin: 0 !important;
    padding-left: 0 !important;
    padding-right: 0 !important;
  }
}

@media (min-width: 1440px) {
  .VPContent.has-sidebar {
    padding-left: 0 !important;
    padding-right: 0 !important;
  }

  .VPDoc.has-sidebar .container {
    max-width: 100% !important;
    margin: 0 !important;
    padding-left: 0 !important;
    padding-right: 0 !important;
  }
}

@media (min-width: 1920px) {
  .VPContent.has-sidebar {
    padding-left: 0 !important;
    padding-right: 0 !important;
  }

  .VPDoc.has-sidebar .container {
    max-width: 100% !important;
    margin: 0 !important;
    padding-left: 0 !important;
    padding-right: 0 !important;
  }
}
</style>

<!-- Service Worker Registration for Search Index Caching -->
<script>
// æ³¨å†Œ Service Worker å®ç°æœç´¢ç´¢å¼•æŒä¹…åŒ–ç¼“å­˜
if ('serviceWorker' in navigator && (location.protocol === 'https:' || location.hostname === 'localhost' || location.hostname === '127.0.0.1')) {
  window.addEventListener('load', function() {
    navigator.serviceWorker.register('/sw.js', { scope: '/' })
      .then(function(registration) {
        console.log('[FlexSearch] âœ… Service Worker æ³¨å†ŒæˆåŠŸ');

        // ç›‘å¬ç´¢å¼•æ›´æ–°é€šçŸ¥
        navigator.serviceWorker.addEventListener('message', function(event) {
          if (event.data.type === 'INDEX_UPDATE_AVAILABLE') {
            console.log('[FlexSearch] ğŸ†• æœç´¢ç´¢å¼•å·²æ›´æ–°ï¼Œæ–°ç‰ˆæœ¬:', event.data.version);
            // å¯é€‰ï¼šæ˜¾ç¤ºé€šçŸ¥æç¤ºç”¨æˆ·åˆ·æ–°
            // æˆ–è€…ï¼šè‡ªåŠ¨é‡æ–°åŠ è½½ç´¢å¼•
          }
        });

        // æ£€æŸ¥æ˜¯å¦æœ‰ç­‰å¾…æ¿€æ´»çš„ SW
        if (registration.waiting) {
          console.log('[FlexSearch] â³ æœ‰æ–°ç‰ˆæœ¬ Service Worker ç­‰å¾…æ¿€æ´»');
        }

        // ç›‘å¬ SW æ›´æ–°
        registration.addEventListener('updatefound', function() {
          const newWorker = registration.installing;
          console.log('[FlexSearch] ğŸ”„ æ£€æµ‹åˆ° Service Worker æ›´æ–°');

          newWorker.addEventListener('statechange', function() {
            if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
              console.log('[FlexSearch] âœ… æ–°ç‰ˆæœ¬ Service Worker å·²å®‰è£…');
            }
          });
        });
      })
      .catch(function(err) {
        console.warn('[FlexSearch] âš ï¸ Service Worker æ³¨å†Œå¤±è´¥:', err);
      });
  });
} else if ('serviceWorker' in navigator) {
  console.log('[FlexSearch] â„¹ï¸ Service Worker ä»…åœ¨ HTTPS ä¸‹å·¥ä½œï¼ˆlocalhost é™¤å¤–ï¼‰');
}
</script>


